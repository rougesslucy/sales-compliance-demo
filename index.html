<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>é”€å”®åˆè§„å«å£« Â· Web Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --card-bg: #0b1020;
      --card-border: #1f2937;
      --accent-sales: #22c55e;
      --accent-legal: #f97316;
      --accent-admin: #3b82f6;
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --radius-lg: 18px;
      --shadow-soft: 0 18px 45px rgba(15,23,42,0.6);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background: radial-gradient(circle at top left,#0f172a,#020617 55%,#000);
      color: var(--text-main);
      min-height: 100vh;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      padding: 10px 16px;
      backdrop-filter: blur(16px);
      background: radial-gradient(circle at top left, rgba(59,130,246,0.35), transparent 55%)
                  ,linear-gradient(to right, rgba(15,23,42,0.96), rgba(15,23,42,0.92));
      border-bottom: 1px solid rgba(148,163,184,0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }
    header h1 {
      font-size: 16px;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
      letter-spacing: 0.03em;
    }
    header h1 span.logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #facc15, #ea580c);
      color: #020617;
      font-weight: 800;
      font-size: 16px;
      box-shadow: 0 0 0 2px rgba(248,250,252,0.05), 0 8px 18px rgba(15,23,42,0.8);
    }
    header h1 small {
      font-size: 11px;
      color: var(--text-sub);
      opacity: 0.9;
    }

    .tabs {
      display: inline-flex;
      padding: 3px;
      border-radius: 999px;
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(148,163,184,0.45);
      box-shadow: 0 10px 30px rgba(15,23,42,0.8);
    }
    .tab-btn {
      border-radius: 999px;
      border: none;
      padding: 5px 14px;
      font-size: 12px;
      background: transparent;
      cursor: pointer;
      color: var(--text-sub);
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all .18s ease-out;
    }
    .tab-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(148,163,184,0.7);
    }
    .tab-btn.active {
      background: radial-gradient(circle at top left,#4f46e5,#0ea5e9);
      color: #f9fafb;
      box-shadow: 0 8px 22px rgba(59,130,246,0.85);
    }
    .tab-btn.active .tab-dot {
      background: #facc15;
      box-shadow: 0 0 0 2px rgba(250,204,21,0.25);
    }

    main {
      max-width: 1180px;
      margin: 18px auto 24px;
      padding: 0 14px 24px;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
      gap: 18px;
    }
    @media (max-width: 960px) {
      main { grid-template-columns: 1fr; }
    }

    .card {
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.9));
      border-radius: var(--radius-lg);
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow-soft);
      padding: 16px 16px 14px;
      margin-bottom: 14px;
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: -80px;
      opacity: 0.05;
      background: radial-gradient(circle at top left,#38bdf8,transparent 55%);
      pointer-events: none;
    }
    .card h2 {
      font-size: 14px;
      margin: 0 0 8px;
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
      z-index: 1;
    }
    .card h2 span.icon {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #020617;
      background: radial-gradient(circle at 30% 30%, #f9fafb, #e5e7eb);
    }

    .subtext {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
    }

    label, .label {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 3px;
      display: inline-block;
    }
    select, input[type="text"], textarea {
      width: 100%;
      font-size: 12px;
      border-radius: 10px;
      padding: 6px 8px;
      border: 1px solid #4b5563;
      outline: none;
      background: rgba(15,23,42,0.95);
      color: var(--text-main);
    }
    select:focus, input[type="text"]:focus, textarea:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56,189,248,0.4);
    }
    textarea { resize: vertical; min-height: 60px; }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      position: relative;
      overflow: hidden;
      isolation: isolate;
    }
    .btn-primary {
      background-image: linear-gradient(135deg,#22c55e,#a855f7,#0ea5e9);
      background-size: 200% 200%;
      color: #f9fafb;
      box-shadow: 0 12px 30px rgba(56,189,248,0.4);
      border: 1px solid rgba(15,23,42,0.6);
    }
    .btn-primary::before {
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(circle at 0 0,rgba(248,250,252,0.25),transparent 40%);
      mix-blend-mode: screen;
      opacity:0;
      transition: opacity .18s ease-out;
    }
    .btn-primary:hover::before{opacity:1;}
    .btn-primary:hover{
      background-position:100% 0;
      transform: translateY(-1px);
      box-shadow: 0 14px 40px rgba(56,189,248,0.6);
    }
    .btn-ghost {
      background: rgba(15,23,42,0.7);
      border: 1px solid #4b5563;
      color: var(--text-sub);
    }
    .btn-ghost:hover { background: rgba(31,41,55,0.95); }

    .pill {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border: 1px solid transparent;
    }
    .pill-green {
      background: rgba(34,197,94,0.15);
      color: #bbf7d0;
      border-color: rgba(34,197,94,0.7);
    }
    .pill-amber {
      background: rgba(245,158,11,0.14);
      color: #fed7aa;
      border-color: rgba(245,158,11,0.7);
    }
    .pill-gray {
      background: rgba(148,163,184,0.18);
      color: #e5e7eb;
      border-color: rgba(148,163,184,0.7);
    }

    .badge {
      border-radius: 999px;
      padding: 1px 6px;
      font-size: 10px;
      background: rgba(55,65,81,0.8);
      color: #e5e7eb;
    }

    .question {
      border-radius: 14px;
      border: 1px solid rgba(75,85,99,0.9);
      background: radial-gradient(circle at top left,rgba(15,23,42,0.96),rgba(15,23,42,0.98));
      padding: 10px 10px 8px;
      margin-bottom: 8px;
      position: relative;
      overflow: hidden;
    }
    .question::before{
      content:"";
      position:absolute;
      inset:-40px;
      background: radial-gradient(circle at top right,rgba(59,130,246,0.18),transparent 55%);
      opacity:.4;
      pointer-events:none;
    }
    .question p {
      margin: 0 0 4px;
      font-size: 13px;
      position:relative;
      z-index:1;
    }

    .option {
      position:relative;
      z-index:1;
      display: flex;
      align-items: flex-start;
      gap: 6px;
      font-size: 12px;
      padding: 2px 0;
    }
    .option input[type="radio"] {
      margin-top: 2px;
      accent-color: #38bdf8;
    }

    .small {
      font-size: 11px;
      color: var(--text-sub);
    }
    .list-item {
      font-size: 12px;
      padding: 5px 0;
      border-bottom: 1px dashed rgba(55,65,81,0.9);
    }
    .list-item:last-child { border-bottom: none; }

    .toast {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(15,23,42,0.96);
      color: #e5e7eb;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 18px 45px rgba(15,23,42,0.9);
      z-index: 999;
      border:1px solid rgba(148,163,184,0.5);
    }
    .toast button {
      background: transparent;
      border: none;
      color: #9ca3af;
      cursor: pointer;
      font-size: 12px;
    }
    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      background: #020617;
      color: #facc15;
      padding: 2px 6px;
      border-radius: 999px;
    }

    details summary {
      cursor: pointer;
      list-style: none;
    }
    details summary::-webkit-details-marker { display:none; }
    details summary::before {
      content:"â–¸";
      display:inline-block;
      margin-right:4px;
      font-size:10px;
      color:#9ca3af;
      transform: translateY(-1px);
    }
    details[open] summary::before { content:"â–¾"; }
  </style>
</head>
<body>
  <header>
    <h1>
      <span class="logo">ç›¾</span>
      <span>
        é”€å”®åˆè§„å«å£«
        <br />
        <small>åŸ¹è®­ Â· å¼ºåˆ¶æ»¡åˆ†è€ƒè¯• Â· å®æˆ˜çº é”™ Â· AI ç”»åƒ</small>
      </span>
    </h1>
    <div class="tabs">
      <button class="tab-btn active" data-tab="sales">
        <span class="tab-dot"></span> é”€å”®è§†è§’
      </button>
      <button class="tab-btn" data-tab="legal">
        <span class="tab-dot"></span> æ³•åŠ¡è§†è§’
      </button>
      <button class="tab-btn" data-tab="admin">
        <span class="tab-dot"></span> ç®¡ç†å‘˜è§†è§’
      </button>
    </div>
  </header>

  <main>
    <section id="left-panel"></section>
    <aside id="right-panel"></aside>
  </main>

  <div id="toast" class="toast" style="display:none;">
    <span id="toast-text"></span>
    <button onclick="hideToast()">Ã—</button>
  </div>

  <script>
    // ---- æ¨¡æ‹Ÿæ•°æ® ----
    const SALES = [
      { id: 1, name: "å¼ ä¸‰", dept: "é”€å”®ä¸€éƒ¨" },
      { id: 2, name: "æå››", dept: "é”€å”®äºŒéƒ¨" },
      { id: 3, name: "ç‹äº”", dept: "å¤§å®¢æˆ·éƒ¨" },
    ];

    const QUESTIONS = [
      {
        id: 1,
        text: "ä»¥ä¸‹å“ªä¸€é¡¹å±äºå…¬å¸ä»˜æ¬¾æ¡æ¬¾çš„çº¢çº¿ï¼Ÿ",
        options: [
          "è´¦æœŸè¶…è¿‡90å¤©ä¸”æ— ä»»ä½•æ‹…ä¿/é¢„ä»˜æ¬¾",
          "åœ¨åˆåŒä¸­å†™æ˜å›æ¬¾è´¦æˆ·ä¸ºå…¬å¸å¯¹å…¬è´¦æˆ·",
          "åœ¨åˆåŒä¸­çº¦å®šå‘ç¥¨ç±»å‹ä¸ºä¸“ç¥¨",
          "åœ¨åˆåŒä¸­çº¦å®šæŒ‰æœˆç»“ç®—",
        ],
        correctIndex: 0,
        tag: "ä»˜æ¬¾æ¡æ¬¾-è´¦æœŸä¸æ‹…ä¿",
      },
      {
        id: 2,
        text: "è¿çº¦è´£ä»»æ¡æ¬¾ä¸­ï¼Œå“ªç§å†™æ³•æ›´ç¬¦åˆå…¬å¸åˆ©ç›Šï¼Ÿ",
        options: [
          "åŒæ–¹äº’ä¸ºæ— é™è´£ä»»ï¼Œå¯¹ä¸€åˆ‡ç›´æ¥å’Œé—´æ¥æŸå¤±è´Ÿè´£",
          "ä¹™æ–¹æ‰¿æ‹…æ‰€æœ‰ç›´æ¥æŸå¤±ï¼Œä¸Šä¸å°é¡¶",
          "åŒæ–¹å¯¹ç›´æ¥æŸå¤±æ‰¿æ‹…è´£ä»»ï¼Œæ€»é¢ä¸è¶…è¿‡å½“æœŸåˆåŒé‡‘é¢æˆ–å·²ä»˜é‡‘é¢çš„ä¸€å®šæ¯”ä¾‹",
          "ä¸è®¾ç½®è¿çº¦é‡‘çº¦å®šï¼Œäº¤ç”±æ³•é™¢è‡ªç”±è£é‡",
        ],
        correctIndex: 2,
        tag: "è¿çº¦è´£ä»»-èµ”å¿ä¸Šé™",
      },
      {
        id: 3,
        text: "å…³äºçŸ¥è¯†äº§æƒï¼Œä¸‹åˆ—å“ªç§è¯´æ³•æ˜¯æ­£ç¡®çš„ï¼Ÿ",
        options: [
          "åªè¦åˆåŒç­¾äº†ï¼Œå¯¹æ–¹è‡ªåŠ¨è·å¾—å…¬å¸æ‰€æœ‰ç›¸å…³äº§å“çš„çŸ¥è¯†äº§æƒ",
          "äº¤ä»˜æˆæœçš„çŸ¥è¯†äº§æƒå½’å±å¯ä»¥å•ç‹¬çº¦å®šï¼Œæœªçº¦å®šæ—¶ä¸€èˆ¬é»˜è®¤å½’å¼€å‘æ–¹æ‰€æœ‰",
          "äº¤ä»˜æˆæœçŸ¥è¯†äº§æƒä¸€å®šå½’å®¢æˆ·æ‰€æœ‰",
          "åˆåŒä¸­æ— éœ€çº¦å®šçŸ¥è¯†äº§æƒå½’å±",
        ],
        correctIndex: 1,
        tag: "çŸ¥è¯†äº§æƒ-æˆæœå½’å±",
      },
    ];

    const STORAGE_KEY = "sales_compliance_data_v2";

    function loadData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) return JSON.parse(raw);
      } catch {}
      return { exam_results: [], error_cases: [] };
    }
    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    let data = loadData();
    let currentTab = "sales";
    let currentSalesId = SALES[0].id;

    // ---- å·¥å…·å‡½æ•° ----
    function showToast(text) {
      const toast = document.getElementById("toast");
      document.getElementById("toast-text").innerText = text;
      toast.style.display = "flex";
      setTimeout(() => { toast.style.display = "none"; }, 3600);
    }
    function hideToast() {
      document.getElementById("toast").style.display = "none";
    }

    function getMaxScore(userId) {
      const scores = data.exam_results.filter(r => r.user_id === userId).map(r => r.score);
      return scores.length ? Math.max(...scores) : null;
    }
    function getStatus(userId) {
      const maxScore = getMaxScore(userId);
      if (maxScore === null) return "æœªå‚åŠ è€ƒè¯•";
      if (maxScore === 100) return "å·²åˆè§„ä¸Šå²—";
      return "è€ƒè¯•ä¸­ï¼ˆæœªæ»¡åˆ†ï¼‰";
    }
    function getUserErrors(userId) {
      return data.error_cases.filter(e => e.user_id === userId);
    }

    function analyzeClause(clause, note) {
      const text = (clause || "") + " " + (note || "");
      let category = "å…¶ä»–æ¡æ¬¾";
      let tag = "è¡¨è¿°ä¸è§„èŒƒ";
      let severity = "ä¸­";
      let analysis = "è¯¥æ¡æ¬¾å­˜åœ¨ä¸€å®šé£é™©ï¼Œå»ºè®®ç”±æ³•åŠ¡è¿›ä¸€æ­¥å®¡æŸ¥å¹¶ä¿®è®¢ã€‚";

      if (text.includes("ä»˜æ¬¾") || text.includes("è´¦æœŸ") || text.includes("å›æ¬¾")) {
        category = "ä»˜æ¬¾æ¡æ¬¾";
        tag = "è´¦æœŸä¸å›æ¬¾ä¿éšœ";
        analysis = "ä»˜æ¬¾æ¡æ¬¾ä¸­è´¦æœŸ/æ”¯ä»˜æ¡ä»¶å¯èƒ½è¿‡é•¿æˆ–ä¸æ¸…æ™°ï¼Œéœ€ç¡®ä¿æœ‰é¢„ä»˜æ¬¾ã€æ‹…ä¿æˆ–åˆç†è´¦æœŸã€‚";
      } else if (text.includes("è¿çº¦") || text.includes("èµ”å¿") || text.includes("æŸå¤±")) {
        category = "è¿çº¦è´£ä»»";
        tag = "èµ”å¿èŒƒå›´ä¸ä¸Šé™";
        analysis = "è¿çº¦è´£ä»»çš„èµ”å¿èŒƒå›´æˆ–ä¸Šé™æœªæ˜ç¡®ï¼Œå¯èƒ½å¯¼è‡´å…¬å¸æ‰¿æ‹…è¿‡é«˜è´£ä»»ã€‚";
      } else if (text.includes("çŸ¥è¯†äº§æƒ") || text.includes("IP") || text.includes("è‘—ä½œæƒ")) {
        category = "çŸ¥è¯†äº§æƒ";
        tag = "æˆæœå½’å±ä¸æˆæƒèŒƒå›´";
        analysis = "çŸ¥è¯†äº§æƒå½’å±æˆ–æˆæƒèŒƒå›´ä¸æ¸…æ™°ï¼Œéœ€ç¡®ä¿å…¬å¸ä¿ç•™æ ¸å¿ƒæƒç›Šæˆ–çº¦å®šåˆç†æˆæƒã€‚";
      } else if (text.includes("ä¿å¯†") || text.includes("æœºå¯†")) {
        category = "ä¿å¯†æ¡æ¬¾";
        tag = "ä¿å¯†ä¹‰åŠ¡ä¸ä¾‹å¤–";
        analysis = "ä¿å¯†ä¹‰åŠ¡çš„èŒƒå›´ã€æœŸé™æˆ–ä¾‹å¤–æƒ…å½¢ä¸æ˜ç¡®ï¼Œå¯èƒ½å½±å“ä¿¡æ¯å®‰å…¨å’Œåˆè§„ã€‚";
      }

      if (
        text.includes("æ— é™") ||
        text.includes("æ‰€æœ‰ç›´æ¥å’Œé—´æ¥æŸå¤±") ||
        text.includes("å…¨éƒ¨ç›´æ¥å’Œé—´æ¥æŸå¤±")
      ) {
        severity = "é«˜";
        analysis = "æ¡æ¬¾ä¸­å­˜åœ¨â€œæ— é™è´£ä»»â€æˆ–æ‰¿æ‹…æ‰€æœ‰ç›´æ¥å’Œé—´æ¥æŸå¤±çš„è¡¨è¿°ï¼Œé£é™©å¾ˆé«˜ï¼Œå¿…é¡»ç”±æ³•åŠ¡è°ƒæ•´ã€‚";
      }
      return { category, tag, severity, analysis };
    }

    function buildProfile(userId) {
      const maxScore = getMaxScore(userId);
      const errors = getUserErrors(userId);
      const totalErrors = errors.length;
      const highErrors = errors.filter(e => e.severity === "é«˜").length;

      const tagCount = {};
      errors.forEach(e => {
        if (!e.tag) return;
        tagCount[e.tag] = (tagCount[e.tag] || 0) + 1;
      });
      const topTags = Object.entries(tagCount)
        .sort((a,b)=>b[1]-a[1])
        .slice(0,3);

      let summary = "æš‚æ— å®Œæ•´æ•°æ®ã€‚";
      if (maxScore === null && totalErrors === 0) {
        summary = "å°šæœªå‚åŠ è€ƒè¯•ï¼Œä¹Ÿå°šæœªåœ¨åˆåŒä¸­æš´éœ²é”™è¯¯ï¼Œå»ºè®®å°½å¿«å®ŒæˆåŸºç¡€åˆè§„åŸ¹è®­ã€‚";
      } else if (maxScore === 100 && totalErrors === 0) {
        summary = "è€ƒè¯•å·²æ»¡åˆ†é€šè¿‡ï¼Œå½“å‰æ— è®°å½•é”™è¯¯ï¼Œåˆè§„åŸºç¡€è¾ƒå¥½ï¼Œè¯·ä¿æŒã€‚";
      } else if (maxScore === 100 && totalErrors > 0) {
        summary = "ç†è®ºè€ƒè¯•è¡¨ç°è‰¯å¥½ï¼Œä½†åœ¨å®é™…åˆåŒä¸­ä»æœ‰é”™è¯¯æš´éœ²ï¼Œå»ºè®®ç»“åˆé”™è¯¯æ¡ˆä¾‹è¿›è¡Œé’ˆå¯¹æ€§å¤ç›˜ã€‚";
      } else if (maxScore !== null && maxScore < 100 && totalErrors > 0) {
        summary = "è€ƒè¯•å°šæœªæ»¡åˆ†ä¸”å®åŠ¡ä¸­å¤šæ¬¡å‡ºç°é”™è¯¯ï¼Œå»ºè®®å°½å¿«å®ŒæˆåŸºç¡€åŸ¹è®­ï¼Œå¹¶ç”±æ³•åŠ¡è¿›è¡Œé‡ç‚¹è¾…å¯¼ã€‚";
      } else if (maxScore !== null && maxScore < 100 && totalErrors === 0) {
        summary = "å°šæœªæ»¡åˆ†é€šè¿‡è€ƒè¯•ï¼Œå»ºè®®ä¼˜å…ˆå®Œæˆè€ƒè¯•ï¼Œå¹¶å…³æ³¨é«˜é£é™©æ¡æ¬¾çš„å­¦ä¹ ã€‚";
      }
      return { maxScore, totalErrors, highErrors, topTags, summary };
    }

    // ---- å³ä¾§é¢æ¿ ----
    function renderRightPanel() {
      const right = document.getElementById("right-panel");
      const s = SALES.find(x => x.id === currentSalesId);
      const profile = buildProfile(currentSalesId);

      let html = `<div class="card">
        <h2><span class="icon">ğŸ§ </span>${s.name} çš„åˆè§„ç”»åƒ</h2>
        <div class="small">éƒ¨é—¨ï¼š${s.dept}</div>
        <ul class="small" style="margin-top:6px;padding-left:16px;">
          <li>æœ€é«˜è€ƒè¯•åˆ†ï¼š${profile.maxScore !== null ? profile.maxScore + " åˆ†" : "æš‚æ— "}</li>
          <li>è®°å½•é”™è¯¯æ¬¡æ•°ï¼š${profile.totalErrors}ï¼ˆå…¶ä¸­é«˜ä¸¥é‡åº¦ ${profile.highErrors}ï¼‰</li>
          <li>é«˜é¢‘é£é™©çŸ¥è¯†ç‚¹ï¼š${
            profile.topTags.length
              ? profile.topTags.map(t => `${t[0]}ï¼ˆ${t[1]} æ¬¡ï¼‰`).join("ï¼Œ")
              : "æš‚æ— "
          }</li>
        </ul>
        <div class="small" style="margin-top:8px;padding:8px 10px;border-radius:12px;background:rgba(15,23,42,0.9);border:1px solid #4b5563;">
          ${profile.summary}
        </div>
      </div>`;

      html += `<div class="card">
        <h2><span class="icon">ğŸ“Š</span>å…¨å‘˜åˆè§„çŠ¶æ€ä¸€è§ˆ</h2>`;

      SALES.forEach(sale => {
        const p = buildProfile(sale.id);
        const status = getStatus(sale.id);
        let pillClass = "pill-gray";
        if (status === "å·²åˆè§„ä¸Šå²—") pillClass = "pill-green";
        else if (status === "è€ƒè¯•ä¸­ï¼ˆæœªæ»¡åˆ†ï¼‰") pillClass = "pill-amber";

        html += `<div class="list-item">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
            <div>
              <div><strong>${sale.name}</strong> Â· ${sale.dept}</div>
              <div class="small">æœ€é«˜åˆ†ï¼š${p.maxScore ?? 0} Â· é”™è¯¯ï¼š${p.totalErrors}</div>
            </div>
            <span class="pill ${pillClass}">${status}</span>
          </div>
        </div>`;
      });

      html += `</div>`;
      right.innerHTML = html;
    }

    // ---- å·¦ä¾§ï¼šè§†è§’åˆ‡æ¢ ----
    function renderSalesView() {
      const s = SALES.find(x => x.id === currentSalesId);
      const status = getStatus(currentSalesId);
      const maxScore = getMaxScore(currentSalesId);

      let html = `<div class="card">
        <h2><span class="icon">ğŸ“š</span>é”€å”®è§†è§’ï¼šåŸºç¡€åˆè§„è€ƒè¯•</h2>
        <div class="subtext">å¿…é¡» 100 åˆ†æ‰è§†ä¸ºâ€œåˆè§„ä¸Šå²—â€ï¼Œå¯ä»¥å¤šæ¬¡ç­”é¢˜ï¼Œä»¥æœ€é«˜åˆ†ä¸ºå‡†ã€‚</div>
        <div class="small" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:6px;">
          <span>å½“å‰é”€å”®ï¼š<strong>${s.name}</strong>ï¼ˆ${s.dept}ï¼‰</span>
          <span>æœ€é«˜åˆ†ï¼š<strong>${maxScore ?? "æš‚æ— "}</strong></span>
          <span>çŠ¶æ€ï¼š<code>${status}</code></span>
        </div>
        <div id="questions-area">`;

      QUESTIONS.forEach(q => {
        html += `<div class="question">
          <p><strong>Q${q.id}.</strong> ${q.text}</p>
          <div class="small" style="margin-bottom:4px;">çŸ¥è¯†ç‚¹ï¼š${q.tag}</div>`;
        q.options.forEach((opt, idx) => {
          const id = `q${q.id}_opt${idx}`;
          html += `<label class="option">
            <input type="radio" name="q${q.id}" value="${idx}" id="${id}" />
            <span>${opt}</span>
          </label>`;
        });
        html += `</div>`;
      });

      html += `</div>
        <button class="btn btn-primary" style="margin-top:6px;" onclick="submitExam()">æäº¤å¹¶è¯„åˆ† âœ…</button>
      </div>`;

      document.getElementById("left-panel").innerHTML = html;
    }

    function renderLegalView() {
      let html = `<div class="card">
        <h2><span class="icon">âš–ï¸</span>æ³•åŠ¡è§†è§’ï¼šå½•å…¥é”™è¯¯æ¡æ¬¾ + è‡ªåŠ¨åˆ†æ</h2>
        <div class="subtext">å‘ç°åˆåŒæœ‰é—®é¢˜çš„æ¡æ¬¾æ—¶ï¼Œé€‰é”€å”® + ç²˜è´´æ¡æ¬¾ï¼Œä¸€é”®ç”Ÿæˆæ ‡ç­¾å’Œé£é™©è¯´æ˜ã€‚</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;">
          <div>
            <label>æ¶‰åŠé”€å”®</label>
            <select id="legal-sales">`;
      SALES.forEach(s => {
        html += `<option value="${s.id}">${s.name}ï¼ˆ${s.dept}ï¼‰</option>`;
      });
      html += `</select>
          </div>
          <div>
            <label>åˆåŒ / é¡¹ç›®åç§°</label>
            <input type="text" id="contract-name" placeholder="ä¾‹å¦‚ï¼š2025å¹´åº¦ XX å®¢æˆ·æœåŠ¡åˆåŒ" />
          </div>
        </div>
        <div style="margin-bottom:8px;">
          <label>é”™è¯¯æ¡æ¬¾åŸæ–‡</label>
          <textarea id="clause" rows="5" placeholder="æŠŠé”€å”®å†™é”™æˆ–æœ‰é£é™©çš„æ¡æ¬¾ç²˜è´´åˆ°è¿™é‡Œâ€¦â€¦"></textarea>
        </div>
        <div style="margin-bottom:8px;">
          <label>æ³•åŠ¡è¡¥å……è¯´æ˜ï¼ˆå¯é€‰ï¼‰</label>
          <textarea id="note" rows="3" placeholder="ä¾‹å¦‚ï¼šèµ”å¿è´£ä»»çº¦å®šä¸¥é‡å¤±è¡¡ï¼Œå¯¹æˆ‘æ–¹æå…¶ä¸åˆ©ï¼›éœ€å¢åŠ èµ”å¿ä¸Šé™ç­‰ã€‚"></textarea>
        </div>
        <button class="btn btn-primary" onclick="submitError()">æäº¤å¹¶è‡ªåŠ¨åˆ†æ ğŸ”</button>
      </div>`;

      html += `<div class="card">
        <h2><span class="icon">ğŸ“‚</span>æœ€è¿‘å½•å…¥çš„é”™è¯¯</h2>`;

      if (!data.error_cases.length) {
        html += `<div class="small">ç›®å‰è¿˜æ²¡æœ‰ä»»ä½•é”™è¯¯è®°å½•ã€‚</div>`;
      } else {
        data.error_cases.slice(0, 10).forEach(e => {
          const user = SALES.find(s => s.id === e.user_id);
          html += `<details class="list-item">
            <summary>
              <span class="small">${e.time}</span> Â· 
              <strong>${user ? user.name : "æœªçŸ¥é”€å”®"}</strong> Â· 
              <span class="small">${e.contract_name}</span> Â· 
              <span class="badge">${e.category}</span> Â· 
              <span class="badge">ä¸¥é‡ï¼š${e.severity}</span>
            </summary>
            <div class="small" style="margin-top:4px;"><strong>çŸ¥è¯†æ ‡ç­¾ï¼š</strong>${e.tag}</div>
            <div class="small"><strong>é”™è¯¯æ¡æ¬¾ï¼š</strong><br/>${e.clause.replace(/\n/g,"<br/>")}</div>`;
          if (e.note) {
            html += `<div class="small"><strong>æ³•åŠ¡å¤‡æ³¨ï¼š</strong>${e.note}</div>`;
          }
          html += `<div class="small"><strong>é£é™©è¯´æ˜ï¼š</strong>${e.analysis}</div>
          </details>`;
        });
      }

      html += `</div>`;
      document.getElementById("left-panel").innerHTML = html;
    }

    function renderAdminView() {
      let html = `<div class="card">
        <h2><span class="icon">ğŸ› </span>ç®¡ç†å‘˜è§†è§’ï¼šå…¨å‘˜ç”»åƒ</h2>
        <div class="subtext">ç¤ºä¾‹ç‰ˆæœªåšç™»å½•æ§åˆ¶ï¼Œå¦‚æœè¦å¯†ç æˆ–å•ç‚¹ç™»å½•ï¼Œå¯ä»¥åœ¨åç«¯æ¥ä¼ä¸šç»Ÿä¸€è®¤è¯ã€‚</div>`;

      SALES.forEach(s => {
        const p = buildProfile(s.id);
        html += `<div class="list-item">
          <div><strong>${s.name}</strong> Â· ${s.dept}</div>
          <div class="small">æœ€é«˜åˆ†ï¼š${p.maxScore ?? 0} Â· é”™è¯¯ï¼š${p.totalErrors} Â· é«˜ä¸¥é‡ï¼š${p.highErrors}</div>
        </div>`;
      });

      html += `</div>`;

      const s = SALES.find(x => x.id === currentSalesId);
      const p = buildProfile(currentSalesId);

      html += `<div class="card">
        <h2><span class="icon">ğŸ”</span>æŒ‡å®šé”€å”®çš„è¯¦ç»†ç”»åƒ</h2>
        <div style="margin-bottom:8px;">
          <label>é€‰æ‹©é”€å”®</label>
          <select id="admin-sales" onchange="onAdminSalesChange(this.value)">`;
      SALES.forEach(sale => {
        html += `<option value="${sale.id}" ${sale.id===currentSalesId?"selected":""}>${sale.name}ï¼ˆ${sale.dept}ï¼‰</option>`;
      });
      html += `</select>
        </div>
        <ul class="small" style="padding-left:16px;">
          <li>æœ€é«˜è€ƒè¯•åˆ†ï¼š${p.maxScore !== null ? p.maxScore : "æš‚æ— "}</li>
          <li>è®°å½•é”™è¯¯æ€»æ•°ï¼š${p.totalErrors}ï¼ˆå…¶ä¸­é«˜ä¸¥é‡åº¦ ${p.highErrors}ï¼‰</li>
          <li>é«˜é¢‘é£é™©çŸ¥è¯†ç‚¹ï¼š${
            p.topTags.length ? p.topTags.map(t => `${t[0]}ï¼ˆ${t[1]} æ¬¡ï¼‰`).join("ï¼Œ") : "æš‚æ— "
          }</li>
        </ul>
        <div class="small" style="margin-top:8px;padding:8px 10px;border-radius:12px;background:rgba(15,23,42,0.9);border:1px solid #4b5563;">
          ${p.summary}
        </div>
        <div style="margin-top:8px;">
          <div class="label">åŸå§‹é”™è¯¯è®°å½•ï¼š</div>`;
      const errs = getUserErrors(currentSalesId);
      if (!errs.length) {
        html += `<div class="small">è¯¥é”€å”®æš‚æ—¶è¿˜æ²¡æœ‰é”™è¯¯è®°å½•ã€‚</div>`;
      } else {
        errs.forEach(e => {
          html += `<div class="small" style="margin-bottom:4px;">
            - ${e.time} Â· ${e.contract_name} Â· ${e.category} Â· ä¸¥é‡ï¼š${e.severity} Â· æ ‡ç­¾ï¼š${e.tag}
          </div>`;
        });
      }
      html += `</div></div>`;

      document.getElementById("left-panel").innerHTML = html;
    }

    // ---- æäº¤é€»è¾‘ ----
    function submitExam() {
      const answers = {};
      let missing = 0;
      QUESTIONS.forEach(q => {
        const chosen = document.querySelector(`input[name="q${q.id}"]:checked`);
        if (!chosen) missing++;
        else answers[q.id] = Number(chosen.value);
      });
      if (missing > 0) {
        showToast(`è¿˜æœ‰ ${missing} é¢˜æœªä½œç­”`);
        return;
      }
      let correct = 0;
      QUESTIONS.forEach(q => {
        if (answers[q.id] === q.correctIndex) correct++;
      });
      const score = Math.round((correct / QUESTIONS.length) * 100);
      data.exam_results.push({
        user_id: currentSalesId,
        score,
        time: new Date().toLocaleString(),
      });
      saveData();
      if (score === 100) {
        showToast(`æœ¬æ¬¡å¾—åˆ† ${score} åˆ†ï¼šå·²æ»¡åˆ†é€šè¿‡ï¼Œç³»ç»Ÿè®°å½•ä¸ºâ€œåˆè§„ä¸Šå²—â€ã€‚`);
      } else {
        showToast(`æœ¬æ¬¡å¾—åˆ† ${score} åˆ†ï¼Œå°šæœªè¾¾åˆ° 100 åˆ†ï¼Œè¯·ç»§ç»­å­¦ä¹ å¹¶å†æ¬¡ä½œç­”ã€‚`);
      }
      renderRightPanel();
    }

    function submitError() {
      const salesId = Number(document.getElementById("legal-sales").value);
      const contractName = document.getElementById("contract-name").value.trim();
      const clause = document.getElementById("clause").value.trim();
      const note = document.getElementById("note").value.trim();
      if (!contractName || !clause) {
        showToast("åˆåŒåç§°å’Œé”™è¯¯æ¡æ¬¾ä¸èƒ½ä¸ºç©ºã€‚");
        return;
      }
      const ai = analyzeClause(clause, note);
      data.error_cases.unshift({
        user_id: salesId,
        contract_name: contractName,
        clause,
        note,
        category: ai.category,
        tag: ai.tag,
        severity: ai.severity,
        analysis: ai.analysis,
        time: new Date().toLocaleString(),
      });
      saveData();
      showToast("å·²è®°å½•è¯¥é”™è¯¯å¹¶ç”Ÿæˆé£é™©æ ‡ç­¾ã€‚");
      renderLeftPanel();
      renderRightPanel();
    }

    function onAdminSalesChange(val) {
      currentSalesId = Number(val);
      renderLeftPanel();
      renderRightPanel();
    }

    function renderLeftPanel() {
      if (currentTab === "sales") renderSalesView();
      else if (currentTab === "legal") renderLegalView();
      else renderAdminView();
    }

    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentTab = btn.dataset.tab;
        renderLeftPanel();
        renderRightPanel();
      });
    });

    // åˆæ¬¡æ¸²æŸ“
    renderLeftPanel();
    renderRightPanel();
  </script>
</body>
</html>
